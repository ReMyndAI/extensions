# ReMynd Extension Guide
This guide outlines the steps for creating your own ReMynd extensions. 

## About Extensions
ReMynd extensions allow users to add custom functionality to their ReMynd experience. They can react to events broadcast by ReMynd, inspect the state of other applications, display UI, record audio, and much more.

Extensions can be built in one of two ways:

- **Workflows:** Workflows are an easy way to implement logic using a drag-and-drop interface. No coding is necessary, and they provide helpers to integrate with the ReMynd database and AI backends.
Workflows are a good choice if your needs are simple and don't require extensive scripting.
- **Python:** An extension can also include Python scripts for more advanced use cases. This allows you to run arbirtrary code and integrate with ReMynd at a deeper level. Python scripts are launched as background tasks that can run persistently.

You can also use a combination of both methods: for example, a Python script can trigger a workflow to run with custom input.

### Extension Manager
The Extension Manager is the interface where all extensions are managed. It can be found by clicking the ReMynd menu bar icon -> Extensions -> Extension Manager. 

## First Steps
To create your own extension, click "Create Extension" in the lower left-hand corner of the Extension Manager. This will generate the necessary folder structure for your extension, including a `manifest.json` file. Click "Show in Finder" to view this folder in a Finder window.

### Manifest
Every extension requires a `manifest.json` file with the following keys:

- `id`: A unique UUID to identify the extension. This is automatically generated for you.
- `name`: Your extension's name.
- `description`: A description for your extension.
- `version`: The extension's current version number.
- `minReMyndVersion`: The minimum version of ReMynd supported by this extension. This should generally not be changed.

Do not edit the `manifest.json` file directly; instead update your extension's name, description and version in the Extension Manager UI.

### scripts.json
The `scripts.json` file contains your workflows. Do not edit this file directly; instead use the editor in the Extension Manager.


## Workflows
Your extension includes a single workflow by default. Select this workflow to view the workflow editor.

### Name
You can rename your workflow using the field in the toolbar at the top of the window.

### Input
Your workflow can optionally accept input provided as text. The `input` field in the editor allows you to test your extension with arbitrary input.
When triggered programatically (e.g. from a Python script), this input will be overridden. When triggered from the Ask window, the input will be a query provided by the user.

### Ask Integration
By selecting "Enable workflow for Ask", your workflow will become available as a custom script in the ReMynd Ask window. This allows you to override the default Ask behavior with custom logic.
The input provided to your workflow will be the query entered by the user in the Ask window.

### Steps
Add as many steps to your workflow as needed. You can request LLM text generation, query the ReMynd database, run scripts, and more. Each step contains a Help menu for extra assistance.

### Output
The output of the final step in your workflow, if any, will be returned as the final result. This result will be displayed to the user in the Ask window if enabled.

## Python
To add your own Python code and enable background execution, click "Add Python Script" at the top of the window. This adds a `main.py` file to your extension directory, along with the required `remynd.py` library.

**Important:** Your main Python script must be named `main.py`, and it must execute `message_center.run()` at the end to run in persistently in the background. This is implemented for you in the generated script:

```python
import remynd
import asyncio

# Create a MessageCenter instance
loop = asyncio.get_event_loop()
message_center = remynd.MessageCenter(loop)

# Your code here

remynd.log("Listening for incoming messages...")
message_center.run() # Will run forever
```

### Python version
The ReMynd app bundle includes the Python 3.11 runtime for running extension code. The Python standard library and some basic modules are included in this installation, but any extra modules required by an extension should be included inside its folder.

### Redis
All communication between extensions and ReMynd happens via Redis channels. The Redis server is packaged with ReMynd and is launched at app startup. Extensions do not need to worry about the details of this communication, and should use the `MessageCenter` APIs in the `remynd` module to communicate with the app.

### ReMynd library
A module named `remynd` is required for extensions to communicate with the parent app. The library is fully self-contained in the `remynd.py` file; this file should be packaged with your extension.

#### MessageCenter
Create an instance of `MessageCenter` to handle communication with ReMynd.

You can subscribe to app events broadcast by ReMynd using the `subscribe` method:

```python
async def event_handler(channel, event, msg):
    remynd.log(f"Got an event message: {event}")

# Subscribes to all events on the "calls" channel
message_center.subscribe('calls', event_handler)
```

You can send messages to ReMynd using `send_message`:

```python
my_msg = {
    "event": "ui.renderHTML",
    "data": {
        "html": "HTML_CODE_HERE",
        "width": 420,
        "height": 600
    }
}
response = await message_center.send_message(my_msg)
```

Supported message types are outlined below.

#### Log
Log messages to the Extension Manager console like this:

```python
remynd.log("This is a log message!")
```

#### Dictionary

You can also use `remynd.Dictionary` to store non-critical data in Redis. For a more complex example see `demo/main.py`.

### Debugging

You can run and debug your extension directly from an editor such as VS Code while the ReMynd app is running. It is not required for ReMynd to launch your extension process for debugging purposes.


## Events (Notifications)

Below is a list of channels used to broadcast app-wide events. An extension may subscribe to as many channels as needed.

### `system` channel

* `applicationDidLaunch` An application did launch
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "pid": 28676,
    "executableURL": "file:///System/Applications/Mail.app/Contents/MacOS/Mail",
    "launchDate": 724704879.7656999,
    "appName": "Mail",
    "isActive": true,
    "bundleURL": "file:///System/Applications/Mail.app/",
    "timestamp": 724704880.046299,
    "bundleID": "com.apple.mail"
}
```
</details>

* `applicationDidActivate` An application was activated
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "pid": 28676,
    "executableURL": "file:///System/Applications/Mail.app/Contents/MacOS/Mail",
    "launchDate": 724704879.7656999,
    "appName": "Mail",
    "isActive": true,
    "bundleURL": "file:///System/Applications/Mail.app/",
    "timestamp": 724704879.960106,
    "bundleID": "com.apple.mail"
}
```
</details>

* `applicationDidDeactivate` An application was deactivated
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "pid": 28676,
    "executableURL": "file:///System/Applications/Mail.app/Contents/MacOS/Mail",
    "launchDate": 724704879.7656999,
    "appName": "Mail",
    "isActive": false,
    "bundleURL": "file:///System/Applications/Mail.app/",
    "timestamp": 724704895.917056,
    "bundleID": "com.apple.mail"
}
```
</details>

* `applicationDidTerminate` An application was terminated
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "pid": 745,
    "executableURL": "file:///System/Applications/Mail.app/Contents/MacOS/Mail",
    "isActive": false,
    "launchDate": 724626816.0797701,
    "appName": "Mail",
    "bundleURL": "file:///System/Applications/Mail.app/",
    "timestamp": 724704877.431679,
    "bundleID": "com.apple.mail"
}
```
</details>

* `focusedWindowChanged` The currently-focused window did change.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "appName": "Mail",
    "id": "2583",
    "pid": 745,
    "timestamp": 724704877.431679,
    "title": "Inbox"
}
```
</details>

* `leftMouseUp` The user did click the left mouse button.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "locationInWindow": [0.25, 0.4],
    "timestamp": 724704877.431679
}
```
</details>

* `keyUp` The user did press and release a keyboard button.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "timestamp": 724704877.431679
}
```
</details>

* `scrollWheel` The user did scroll.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "timestamp": 724704877.431679
}
```
</details>

### `recorder` channel

* `didCaptureFrame` ReMynd recorder captured a new frame
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    // Integer position for better precision
    "position": 1021807592431, 
    // Floating value timestamp
    // timestamp = position / 600
    "timestamp": 1703012654.0516667,
    "cursorPosition": [0.25, 0.4],
    // Optional focused window information
    "appName": "Stocks",
    "bundleID": "com.apple.stocks",
    "title": "BTC-USD"
}
```
</details>

* `didCaptureOCR` ReMynd recorder captured new OCR data from the focused window
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    // DB entry id
    'id': 24625,
    // Optional window title
    'title': 'EURUSD=X',
    // Optional URL
    'url': null,
    // Optional Base64 encoded icon
    'appIcon': '<base64-encoded-png-image-data>',
    'timestamp': 1717688799.6166666,
    'position': 1030613279770,
    'appName': 'Stocks',
    'bundleID': 'com.apple.stocks',
    'text': 'EURUSD=X\nEURUSD=X 1,084 -0,14 %\n+\nQ Search\nBusiness News\nFrom Yahoo Finance\nMy Symbols *\nEURUSD=X\nEUR/USD\nGBPUSD=X\nGBP/USD|\nUSDRUB=X\nUSD/RUB\nEURRUB=X\nEUR/RUB\nTON11419-USD\nToncoin USD\nBTC-USD\nBitcoin USD\nETH-USD\nEthereum USD\nILS=X\nUSD/ILS\nyahoo! finance\nEURUSD=X\nCCY • USD\n1D\n1W\n1M\nEUR/USD\n3М\n6M\nYTD\n1Y\n2Y\n5Y\n1,084\n-0,14 %\n1,274\n+0,23%\n90,13\n-0,11 %\n97,85\n-0,11 %\n6,38\n-0,26 %\n70 359,66\n+0,54%\n3757,15\n-1,60 %\n3,669\n+0,13 %\nUpdated on 22.05.2024, 17:36\n1,084\n+1,82 %\nPast Month\n10Y\nALL\n1,090\n1,084\n1,077\n1,071\n-\n-\n22\n29\n6\nOpen\nHigh\nLow\n1,086\n1,087\n1,082\nVol\nP/E\nMkt Cap\n0\n-\n-\nSee More Data from Yahoo Finance >\nInvesting.com\nDollar steady ahead of Fed minutes, sterling\ngains on CPI release\nThe U.S. dollar traded calmly Wednesday ahead of the...\n11h ago\nInvesting.com\nDollar steadies ahead of FOMC minutes, a\ndeluge of Fed speakers\n13\n20\n52W H\n52W L\nAvg Vol\n1,128\n1,045\nYield\nBeta\nEPS\nInvesting.com\nDollar steady; Fed speakers could provide\nimpetus\nThe U.S. dollar traded in a tight range Tuesday, steadyi...\n1d ago\nInvesting.com\nDollar steadies, but on track for sharp weekly\nloss'
}
```
</details>

### `calls` channel

* `callDidStart` ReMynd detected a new call (Zoom, etc.)
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "id": 1703024824,
    "appName": "Zoom",
    "participants": [
        "John Galt",
        "Jonathan Livingston"
    ],
    "callID": 1703024824,
    "startDate": 1703024824.354
}
```
</details>

* `callDidEnd` ReMynd detected a call end
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "endDate": 1703024835.4429998,
    "appName": "Zoom",
    "startDate": 1703024824.354,
    "id": 1703024824,
    "meetingId": 7961251252,
    "participants": [
        "John Galt",
        "Steve Jobs",
        "Steve Ballmer",
    ],
    "title": "John Galt's Personal Meeting Room",
    "callID": 1703024824
}
```
</details>

* `callRecordingStarted` Call audio recording started
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "appName": "Zoom",
    "participants": [
        "John Galt"
    ],
    "callID": 1703024824,
    "startDate": 1703024824.354,
    "id": 1703024824
}
```
</details>

* `callRecordingStopped` Call audio recording stopped
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "endDate": 1703024835.4429998,
    "appName": "Zoom",
    "startDate": 1703024824.354,
    "id": 1703024824,
    "meetingId": 7961251252,
    "participants": [
        "John Galt",
        "Steve Jobs",
        "Steve Ballmer",
    ],
    "title": "John Galt's Personal Meeting Room",
    "callID": 1703024824
}
```
</details>

### `ui` channel

* `positionDidChange` Notifies about the current frame position in Viewer
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    // Integer position for better precision
    "position": 1021807592431, 
    // Floating value timestamp
    // timestamp = position / 600
    "timestamp": 1703012654.0516667
}
```
</details>

## Messages channel

The `messages` channel is used for one-to-one (app-to-extension or extension-to-app) messages. Each message contains an `event` field which contains the function name, and optional `data`.

In order to send a message to the `messages` channel use the `message_center.send_message()` function. In case you provide user-triggered functions or expect other messages from the app to your extension, subscribe to the `messages` channel via `message_center.subscribe()` method.

### `messages` events

* `jsEventFired` Notifies about some JSON data posted from JavaScript which is running within an HTML window created by the extension.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    // Any data passed from within JS using `remynd` message handler
    // For example:
    // window.webkit.messageHandlers.remynd.postMessage({ id: 'settings', close: true });
    "id": "settings",
    "close": true
}
```
</details>

* `notificationCallback` Notifies when the user clicks a popup shown using `showNotification` function with some action data specified
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "action": {
        // This could be any string data specified in showNotification function
        "data": "[724724275, 724724276, 724724277, 724724278]"
    },
    "notificationID": "05707C81-9C2F-43AF-B595-8926BEEC94EC"
}
```
</details>

* `goBack` Notifies that 'Back' button was pressed
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "windowID": 1234,
    // Optional
    "windowTag": "main"
}
```
</details>

* `nextItem` Notifies that 'Next' button was pressed
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "windowID": 1234,
    // Optional
    "windowTag": "main"
}
```
</details>

* `previousItem` Notifies that 'Previous' button was pressed
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "windowID": 1234,
    // Optional
    "windowTag": "main"
}
```
</details>

* `windowWillClose` Notifies that one of the extension's windows is about to close
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "windowID": 1234,
    // Optional
    "windowTag": "main"
}
```
</details>

* `aiResponseStream` Response stream updates from an AI query
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "text": "Monitoring real-time currency\nexchange data and financial news\nupdates, particularly focusing on",
    // Optional (for streaming mode)
    "streamId": "0A7C792B-F121-4C47-B20A-BA06251B7A7B",
    "tokens": 42
}
```
</details>

### `extension` functions

* `extension.register` Registers an extension's capabilities. Send this message if you want to create standalone UI, settings UI or some entity functions.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "extension.register",
    "data": {
        "capabilities": {
            // Optional – standalone UI windows
            // in this example the 'uiPlayground' function should open some playground window
            "standalone": [
                {
                    "title": "UI Playground", // Menu title
                    "event": "uiPlayground",  // Event name to use (posted within 'messages' channel)
                },
            ],
            // Optional – settings windows
            // in this example the 'settings' function should open settings window
            "settings": [
                {
                    "title": "Settings",
                    "event": "settings",
                },
            ],
            // Optional – functions that process recorded calls
            // in this example the 'callSummary' function will receive a `call` entity
            "call": [
                {
                    "title": "Create Summary",
                    "event": "callSummary",
                }
            ],
            // Optional – functions that process current position
            // in this example the 'windowList' function will receive a player position
            // (as timestamp and more precise integer value)
            "frame": [
                {
                    "title": "List Windows",
                    "event": "windowList",
                }
            ],
        }
    }
}
```
Response:
```JSON
"OK"
```
</details>

### `system` functions

* `system.getLocale` Get a list of user preferred locales (language and region codes). Use this function to determine correct language and format.

<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "event": "system.getLocale"
}
```
Response:
```JavaScript
[
    'en_US', 'de_DE', 'ru_RU'
]
```
</details>

* `system.getRunningApps` Get a list of currently running applications. 

<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "event": "system.getRunningApps"
}
```
Response:
```JavaScript
{
    "runningApps": [
        {
            "executableURL": "file:///System/Library/CoreServices/loginwindow.app/Contents/MacOS/loginwindow",
            "isActive": false,
            "pid": 597,
            "bundleURL": "file:///System/Library/CoreServices/loginwindow.app/",
            "appName": "loginwindow",
            "bundleID": "com.apple.loginwindow"
        },
        {
            "appName": "CoreLocationAgent",
            "executableURL": "file:///System/Library/CoreServices/CoreLocationAgent.app/Contents/MacOS/CoreLocationAgent",
            "pid": 1151,
            "bundleURL": "file:///System/Library/CoreServices/CoreLocationAgent.app/",
            "bundleID": "com.apple.CoreLocationAgent",
            "isActive": false
        },
        {
            "appName": "Mail",
            "executableURL": "file:///System/Applications/Mail.app/Contents/MacOS/Mail",
            "isActive": false,
            "pid": 1764,
            "bundleURL": "file:///System/Applications/Mail.app/",
            "bundleID": "com.apple.mail",
            "launchDate": 1702343607.162433
        },
        {
            "bundleURL": "file:///System/Volumes/Preboot/Cryptexes/App/System/Applications/Safari.app/",
            "bundleID": "com.apple.Safari",
            "pid": 1765,
            "appName": "Safari",
            "launchDate": 1702343607.17921,
            "executableURL": "file:///System/Volumes/Preboot/Cryptexes/App/System/Applications/Safari.app/Contents/MacOS/Safari",
            "isActive": false
        },
        //
        // ...
        //
        {
            "launchDate": 1702389912.3138142,
            "bundleURL": "file:///Applications/Xcode.app/",
            "executableURL": "file:///Applications/Xcode.app/Contents/MacOS/Xcode",
            "bundleID": "com.apple.dt.Xcode",
            "pid": 7793,
            "isActive": false,
            "appName": "Xcode"
        }
    ]
}
```
</details>

### `recorder` functions

* `recorder.getFrame` Get a specified frame in PNG format (base64 encoded).
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "recorder.getFrame",
    "data": {
        // Either position or timestamp must be specified
        // timestamp = position / 600

        // Optional
        // more precise Integer position of a frame
        "position": 1021493241857,
        // Optional
        // less precise floating point timestamp of a frame
        "timestamp": 1702488736.4283333
    }
}
```
Response:
```JSON
{
    "imageData": "<base64-encoded-png-image-data>"
}
```
</details>

* `recorder.getFrameOCR` Get OCR data for a specified frame.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "recorder.getFrameOCR",
    "data": {
        // Either position or timestamp must be specified
        // timestamp = position / 600

        // Optional
        // more precise Integer position of a frame
        "position": 1021493241857,
        // Optional
        // less precise floating point timestamp of a frame
        "timestamp": 1702488736.4283333
    }
}
```
Response:
```JavaScript
{
    // Optional window title
    'title': 'EURUSD=X',
    // Optional URL
    'url': null,
    // Optional Base64 encoded icon
    'appIcon': '<base64-encoded-png-image-data>',
    'timestamp': 1717688799.6166666,
    'position': 1030613279770,
    'appName': 'Stocks',
    'bundleID': 'com.apple.stocks',
    'text': 'EURUSD=X\nEURUSD=X 1,084 -0,14 %\n+\nQ Search\nBusiness News\nFrom Yahoo Finance\nMy Symbols *\nEURUSD=X\nEUR/USD\nGBPUSD=X\nGBP/USD|\nUSDRUB=X\nUSD/RUB\nEURRUB=X\nEUR/RUB\nTON11419-USD\nToncoin USD\nBTC-USD\nBitcoin USD\nETH-USD\nEthereum USD\nILS=X\nUSD/ILS\nyahoo! finance\nEURUSD=X\nCCY • USD\n1D\n1W\n1M\nEUR/USD\n3М\n6M\nYTD\n1Y\n2Y\n5Y\n1,084\n-0,14 %\n1,274\n+0,23%\n90,13\n-0,11 %\n97,85\n-0,11 %\n6,38\n-0,26 %\n70 359,66\n+0,54%\n3757,15\n-1,60 %\n3,669\n+0,13 %\nUpdated on 22.05.2024, 17:36\n1,084\n+1,82 %\nPast Month\n10Y\nALL\n1,090\n1,084\n1,077\n1,071\n-\n-\n22\n29\n6\nOpen\nHigh\nLow\n1,086\n1,087\n1,082\nVol\nP/E\nMkt Cap\n0\n-\n-\nSee More Data from Yahoo Finance >\nInvesting.com\nDollar steady ahead of Fed minutes, sterling\ngains on CPI release\nThe U.S. dollar traded calmly Wednesday ahead of the...\n11h ago\nInvesting.com\nDollar steadies ahead of FOMC minutes, a\ndeluge of Fed speakers\n13\n20\n52W H\n52W L\nAvg Vol\n1,128\n1,045\nYield\nBeta\nEPS\nInvesting.com\nDollar steady; Fed speakers could provide\nimpetus\nThe U.S. dollar traded in a tight range Tuesday, steadyi...\n1d ago\nInvesting.com\nDollar steadies, but on track for sharp weekly\nloss'
}
```
</details>

* `recorder.startCallRecording` Start an audio recording of a specified app.

<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "event": "recorder.startCallRecording",
    "data": {
        "pid": 1234
    }
}
```
Response:
```JSON
"OK"
```
</details>

* `recorder.stopCallRecording` Stop an audio recording of a specified app.

<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "event": "recorder.stopCallRecording",
    "data": {
        "pid": 1234
    }
}
```
Response:
```JSON
"OK"
```
</details>

### `ui` functions

* `ui.renderHTML` Render some HTML (and JavaScript) within a separate window.

<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "ui.renderHTML",
    "data": {
        // Optional - window title
        "title": "Window Title",
        // Optional - HTML
        "html": "<html><body><h1>Hello world!</h1><div id=\"content\"></div></body></html>",
        // Optional - JavaScript
        "userScript": "document.getElementById(\"content\").textContent = \"Lorem ipsum\";",
        // Optional - window ID if it's already displayed
        "windowID": 1234,
        // Optional - window width (for new window)
        "width": 900,
        // Optional - window height (for new window)
        "height": 600,
        // Optional – reopen window if specified windowID not found
        "reopen": true,
        // Optional – place window on top of other app windows (could be overriden by user)
        "alwaysOnTop": false,
        // Optional - window tag (string)
        "windowTag": "main",
        // Optional - display a 'back' button in the window toolbar and set its enabled state.
        // When pressed the extension will receive a message called 'goBack'
        "backEnabled": true,
        // Optional - display a 'previous' button in the window toolbar and set its enabled state
        // When pressed the extension will receive a message called 'previousItem'
        "prevEnabled": true,
        // Optional - display a 'next' button in the window toolbar and set its enabled state
        // When pressed the extension will receive a message called 'nextItem'
        "nextEnabled": true,
    }
}
```
Response:
```JSON
{
    "windowID": 1234
}
```
</details>

* `ui.closeWindow` Close a previously displayed window.

<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "event": "ui.closeWindow",
    "data": {
        "windowID": 1234
    }
}
```
Response:
```JSON
"OK"
```
</details>

* `ui.showNotification` Show a small popup notification with optional tap action.

<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "ui.showNotification",
    "data": {
        "text": "Call summary ready.\nClick here to view",
        // Optional
        "action": {
            // Any string data that will be passed
            // to the action handler
            // (see ui.notificationCallback event)
            "data": "This a call summary."
        }
    }
}
```
Response:
```JSON
{
    "notificationID": "a82ae604-9537-49a5-b0bb-25b07cf8c746"
}
```
</details>

* `ui.openAsk` Open Ask (GPT) chat window.

<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "ui.openAsk",
    "data": {
        // Optional - query to send
        "text": "what did i do yesterday?"
    }
}
```
Response:
```JSON
"OK"
```
</details>

* `ui.openSearch` Open Search window.

<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "ui.openAsk",
    "data": {
        // Optional - query string
        "text": "amazon",
        // Optional - filter by app name
        "apps": [
            "Safari",
            "Mail"
        ],
        // Optional - start timestamp
        "startDate": 1699574400,
        // Optional - end timestamp
        "endDate": 1699833600,
        // Optional - search in transcriptions
        "transcripts": true,
        // Optional - sorting option relevance/time
        "sort": "time"
    }
}
```
Response:
```JSON
"OK"
```
</details>

* `ui.openView` Open Viewer.

<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "ui.openView",
    "data": {
        // Optional - player position timestamp
        "date": 1699833600,
        // Optional - zoom level day/week/month/year
        "zoomLevel": "month",
        // Optional - filter frames to selected time ranges
        "filter": [
            {
                "startDate": 1699574400,
                "endDate": 1699833600
            },
            {
                "startDate": 1701388800,
                "endDate": 1702166400
            }
        ]   
    }
}
```
Response:
```JSON
"OK"
```
</details>

* `ui.viewPosition` Set Viewer position (when it's on screen).

<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "ui.viewPosition",
    "data": {
        // Optional – Integer position for better precision
        "position": 1021807592431, 
        // Optional – Floating value timestamp
        // timestamp = position / 600
        "timestamp": 1703012654.0516667
        // Optional - frame selection strategy (closest/leading/trailing)
        "frame": "leading",
    }
}
```
Response:
```JSON
"OK"
```
</details>

### `ai` functions

* `ai.query` Run AI query on the main ReMynd backend.

<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "ai.query",
    "data": {
        // Optional
        "instructions": "Some OCR data from one or more user opened windows will be provided, including application names, optional window titles and optional visited URLs for browser windows. Identify the context on what the user is currently working on and generate a short summary in one impersonal sentence without subject. The result should be a formatted string with line breaks inserted so that there's no more than 35 letters in each line.",
        "text": "EURUSD=X\nEURUSD=X 1,084 -0,14 %\n+\nQ Search\nBusiness News\nFrom Yahoo Finance\nMy Symbols *\nEURUSD=X\nEUR/USD\nGBPUSD=X\nGBP/USD|\nUSDRUB=X\nUSD/RUB\nEURRUB=X\nEUR/RUB\nTON11419-USD\nToncoin USD\nBTC-USD\nBitcoin USD\nETH-USD\nEthereum USD\nILS=X\nUSD/ILS\nyahoo! finance\nEURUSD=X\nCCY • USD\n1D\n1W\n1M\nEUR/USD\n3М\n6M\nYTD\n1Y\n2Y\n5Y\n1,084\n-0,14 %\n1,274\n+0,23%\n90,13\n-0,11 %\n97,85\n-0,11 %\n6,38\n-0,26 %\n70 359,66\n+0,54%\n3757,15\n-1,60 %\n3,669\n+0,13 %\nUpdated on 22.05.2024, 17:36\n1,084\n+1,82 %\nPast Month\n10Y\nALL\n1,090\n1,084\n1,077\n1,071\n-\n-\n22\n29\n6\nOpen\nHigh\nLow\n1,086\n1,087\n1,082\nVol\nP/E\nMkt Cap\n0\n-\n-\nSee More Data from Yahoo Finance >\nInvesting.com\nDollar steady ahead of Fed minutes, sterling\ngains on CPI release\nThe U.S. dollar traded calmly Wednesday ahead of the...\n11h ago\nInvesting.com\nDollar steadies ahead of FOMC minutes, a\ndeluge of Fed speakers\n13\n20\n52W H\n52W L\nAvg Vol\n1,128\n1,045\nYield\nBeta\nEPS\nInvesting.com\nDollar steady; Fed speakers could provide\nimpetus\nThe U.S. dollar traded in a tight range Tuesday, steadyi...\n1d ago\nInvesting.com\nDollar steadies, but on track for sharp weekly\nloss",
        // Optional, default false
        "stream": true,
        // Optional, default app-defined
        "model": "gpt-4o",
        // Optional text/json, default 'text'
        "format": "text"
    }
}
```
Response:
```JavaScript
{
    "text": "Monitoring real-time currency\nexchange data and financial news\nupdates, particularly focusing on\nEUR/USD performance",
    // Optional (for streaming mode)
    "streamId": "0A7C792B-F121-4C47-B20A-BA06251B7A7B",
    "tokens": 42,
    "cost": 0.00234
}
```
</details>

### `sql` functions

* `sql.runSQL` Run arbitrary SQL statement on the main ReMynd SQLite database (read-only).

<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "sql.runSQL",
    "data": {
        "sql": "SELECT id, title, startDate, endDate FROM Call ORDER BY id DESC;",
        // Optional – database to run the query (main/extras)
        "db": "extras"
    }
}
```
Response:
```JavaScript
// NOTE: there's a limit of 100 records per response.
// If you need more records make your own pagination
[
    {
        "id": 1702402242,
        "startDate": 1702402242.804,
        "endDate": 1702404087.014,
        "title": "John Galt's Personal Meeting Room"
    },
    {
        "startDate": 1702315884.984,
        "title": "John Galt's Personal Meeting Room",
        "endDate": 1702318045.139,
        "id": 1702315884
    },
    //
    // ...
    //
    {
        "startDate": 1701279838.45,
        "title": "Jonathan's Personal Meeting Room",
        "endDate": 1701282196.374,
        "id": 1701279838
    }
]
 ```
</details>

### `ax` functions

* `ax.getProcessTree` Get specified process tree of UI elements.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "event": "ax.getProcessTree",
    "data": {
        "pid": 1234
    }
}
```
Response:
```JSON
{
    "windows": [
        {
            "bounds": [
                [ 88, 454 ],
                [ 1556, 436 ]
            ],
            "uuid": "6EA3D3D6-4503-4FD4-B10F-CC56F1177374",
            "title": "vz1500",
            "subrole": "AXStandardWindow",
            "id": "FinderWindow",
            "children": [
                {
                    "uuid": "36CCEE2B-7913-4527-91A9-5CAECBA4A300",
                    "role": "AXStaticText",
                    "bounds": [
                        [ 320, 454 ],
                        [ 503, 52 ]
                    ],
                    "children": []
                },
                {
                    "role": "AXButton",
                    "children": [],
                    "subrole": "AXMinimizeButton",
                    "bounds": [
                        [ 127, 472 ],
                        [ 14, 16 ]
                    ],
                    "uuid": "D57B34B0-48D9-4F5B-AB1D-1EB271075A5A"
                },
                {
                    "subrole": "AXFullScreenButton",
                    "bounds": [
                        [ 147, 472 ],
                        [ 14, 16 ]
                    ],
                    "role": "AXButton",
                    "uuid": "7EB74A1A-69DF-4D43-8817-0A9AAD0D1B4E",
                    "children": [ "..." ]
                },
                {
                    "uuid": "00A9ED87-D1F3-444B-AA84-62B056A4F926",
                    "subrole": "AXCloseButton",
                    "bounds": [
                        [ 107, 472 ],
                        [ 14, 16 ]
                    ],
                    "role": "AXButton",
                    "children": []
                },
                {
                    "uuid": "B6DD0342-06BD-44FF-9440-B3899F186D87",
                    "title": "tab bar",
                    "description": "Tab bar, 3 tabs",
                    "bounds": [
                        [ 235, 506 ],
                        [ 1409, 28 ]
                    ],
                    "role": "AXTabGroup",
                    "children": [ "..." ]
                },
                {
                    "role": "AXSplitGroup",
                    "uuid": "C4751B4A-A5FE-4D0D-A836-F20E78326A95",
                    "children": [
                        {
                            "role": "AXSplitGroup",
                            "bounds": [
                                [ 236, 454 ],
                                [ 1408, 436 ]
                            ],
                            "children": [ "..." ],
                            "uuid": "F1B73762-E455-4FAF-B3CF-DCFD7F745A67"
                        },
                        {
                            "role": "AXSplitter",
                            "uuid": "0172A876-5995-4E56-9C56-513688B8A5F6",
                            "bounds": [
                                [ 235, 534 ],
                                [ 1, 356 ]
                            ],
                            "children": []
                        },
                        {
                            "uuid": "7A454EEA-23E7-4C55-9F32-618893F2AAF5",
                            "bounds": [
                                [ 88, 506 ],
                                [ 147, 384 ]
                            ],
                            "children": [ "..." ],
                            "id": "_NS:61",
                            "role": "AXScrollArea"
                        }
                    ],
                    "bounds": [
                        [ 88, 454 ],
                        [ 1556, 436 ]
                    ]
                }
            ],
            "role": "AXWindow"
        },
        {
            "uuid": "A25C00E7-7CCA-4CC8-92B8-A12293F43274",
            "role": "AXScrollArea",
            "bounds": [
                [ 0, 0 ],
                [ 1728, 1117 ]
            ],
            "description": "desktop",
            "children": [ "..." ]
        }
    ],
    "pid": 1778
}
```
</details>

* `ax.getNodeTree` Get specified node tree of UI elements.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JSON
{
    "event": "ax.getNodeTree",
    "data": {
        "uuid": "A25C00E7-7CCA-4CC8-92B8-A12293F43274"
    }
}
```
Response:
```JSON
{
    "node": {
        "description": "desktop",
        "uuid": "A25C00E7-7CCA-4CC8-92B8-A12293F43274",
        "role": "AXScrollArea",
        "bounds": [
            [ 0, 0 ], [ 1728, 1117 ]
        ],
        "children": [
            {
                "children": [
                    {
                        "bounds": [
                            [ 1631, 606 ],
                            [ 64, 64 ]
                        ],
                        "description": "Old Firefox Data",
                        "children": [],
                        "url": "file:///Users/username/Desktop/Old%20Firefox%20Data/",
                        "role": "AXImage",
                        "title": "Old Firefox Data",
                        "uuid": "2D413F98-4E6C-4C70-A217-BC6D968708FB"
                    },
                    {
                        "role": "AXImage",
                        "description": "Screenshots",
                        "uuid": "BE36E9C2-797F-4DA6-A62C-66593B4BFEB3",
                        "bounds": [
                            [ 1631, 494 ],
                            [ 64, 64 ]
                        ],
                        "children": [],
                        "title": "Screenshots"
                    },
                    {
                        "title": "twitter_web.py",
                        "bounds": [
                            [ 1631, 382 ],
                            [ 64, 64 ]
                        ],
                        "children": [],
                        "role": "AXImage",
                        "description": "twitter_web.py",
                        "url": "file:///Users/username/Desktop/twitter_web.py",
                        "uuid": "FA8E341C-58D2-4CF1-9A66-66E5F90C189B"
                    },
                    {
                        "title": "Movies",
                        "children": [],
                        "role": "AXImage",
                        "uuid": "2BEB0BFB-3793-42E7-8FED-3140602EFF30",
                        "description": "Movies",
                        "bounds": [
                            [ 1631, 270 ],
                            [ 64, 64 ]
                        ]
                    },
                    {
                        "url": "file:///Users/username/Desktop/feed_stat.pdf",
                        "children": [],
                        "title": "feed_stat.pdf",
                        "bounds": [
                            [ 1631, 158 ],
                            [ 64, 64 ]
                        ],
                        "uuid": "F16AB573-FDAE-445D-91A3-F199B3EC44C9",
                        "description": "feed_stat.pdf",
                        "role": "AXImage"
                    },
                    {
                        "title": "Images",
                        "uuid": "D98C15AD-C1FA-42F8-B5A5-8AC820E034B3",
                        "description": "Images",
                        "bounds": [
                            [ 1631, 46 ],
                            [ 64, 64 ]
                        ],
                        "role": "AXImage",
                        "children": []
                    }
                ],
                "description": "desktop",
                "uuid": "B57EE98F-4F5E-4944-B30E-B379E1951532",
                "role": "AXGroup",
                "bounds": [
                    [ 0, 0 ],
                    [ 1728, 1117 ]
                ]
            }
        ]
    }
}
```
</details>

* `ax.setAttributeValue` Set an Accessibility attribue.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "ax.setAttributeValue",
    "data": {
        "pid": 1778,
        "attribute": "title",
        // Optional – set boolean value
        "boolValue": true,
        // Optional – set integer value
        "intValue": 123,
        // Optional – set string value
        "stringValue": "Hello"
    }
}
```
Response:
```JSON
"OK"
```
</details>

### `edb` functions

* `edb.runEdgeQL` Run an artibtrary EdgeQL query on the main ReMynd EdgeDB database.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "edb.runEdgeQL",
    "data": {
        "query": "...",
        // Optional
        "variables": [
            "x": 123,
            "y": 456
        ]
    }
}
```
Response:
```JSON
"OK"
```
</details>

### `workflow` functions

* `workflow.run` Runs a workflow with the provided ID, and customizable input.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "workflow.run",
    "data": {
        "id": "0FFC00D4-4535-405F-9C6F-B10936E595EE",
        "input": "WORKFLOW INPUT HERE"
    }
}
```
Response:
```JSON
{
    "output": "This is the workflow's result. It may contain AI-generated text, JSON objects, or anything else your workflow is configured to return."
}
```
</details>

### `calls` functions

* `calls.setTitle` Set custom title of a call entity.
<details>
<summary><b>Example</b> (click to expand)</summary>

```JavaScript
{
    "event": "calls.setTitle",
    "data": {
        "callID": 1701279838,
        "title": "Big Band Meeting"
    }
}
```
Response:
```JSON
"OK"
```
</details>

## TODO

 - Tips & Tricks
   - JS log
   - Setting up a Workflow
   - Embedding HTML images
   - Call audio URLs
